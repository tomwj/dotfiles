#!/bin/bash
# Use ansible inventory file for ssh aliases.
# defaults to first IP found if environment is declared
# based on this https://www.calebwoods.com/2015/08/02/ssh-ansible-host/
if [ -z "$1" ]; then
  echo "No hostname specified"
  echo "usage: ansible-ssh [hostname] [user=ansible]";
  return 1;
fi
if [ -z "$2" ]; then
  USER=$USER
else
  USER="$2"
fi

if [ -e '/etc/ansible/hosts' ]; then
  DIRECTORIES='/etc/ansible .'
else
  DIRECTORIES='./inventory'
fi
if [ -d "$DIRECTORIES" ]; then
  INVENTORY=`find $DIRECTORIES -name '*hosts' | xargs`
  HOST=`cat $INVENTORY | grep $1 | grep -oE '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -n 1`
  command ssh "$USER@$HOST"
else
  echo "Couldn't find $DIRECTORIES check you're in automation.ansible"
fi
